{{extend 'layout.html'}}

<!-- Profile Header Area -->
<div class="row">
    <div class="span12 prof-header info-header">
        <div class="row">
            <div class="span3">
                <div class="prof-left">
                    <h3 class="center">{{=fullname(userId)}}</h3>
                    {{if user.picture:}}
                        <img src="{{=URL('download', args=user.picture)}}" alt="{{=fullname(userId)}}">
                    {{else:}}
                        <img src="{{=URL('static', 'images/user_placeholder.jpg')}}" alt="{{=fullname(userId)}}">
                    {{pass}}
                </div>
            </div>
            <div class="span3">
                <div class="prof-center">
                    <table class="table">
                        <tr><td>Joined:</td><td>{{=prettydate(user.created_on) or 'N/A'}}</td></tr>
                        <tr><td>Age:</td><td>{{=age or 'N/A'}}</td></tr>
                        <tr><td>Gender:</td><td>{{=info.gender or 'N/A'}}</td></tr>
                        <tr><td>Location:</td><td>{{=info.user_location or 'N/A'}}</td></tr>
                        <tr><td>Genres:</td><td>{{=info.genres or 'N/A'}}</td></tr>
                    </table>
                    {{if auth.user and auth.user.id == userId:}}<a href="#editModal" role="button" data-toggle="modal">edit info</a>{{pass}}
                </div>
            </div>
            <div class="span6">
                <div class="prof-right">
                    <div class="row">
                        <div class="span6 status">
                            <h3>{{=status}}</h3>
                            {{if auth.user and auth.user.id == userId:}}<a href="#statusModal" role="button" data-toggle="modal">edit status</a>{{pass}}
                        </div>
                    </div>
                    <div class="row user-stats">
                        <div class="span6">
                            <table>
                                <tr>
                                    <td>
                                        <h3>{{=totalLikes}}</h3>
                                        <h4>Total Likes</h4>
                                    </td>
                                    <td>
                                        <h3>{{=len(uploads)}}</h3>
                                        <h4>Total Uploads</h4>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{if auth.user and auth.user.id != user.id:}}
        <div class="prof-button-area">
            {{if relationId:}}
                {{=A('Remove Friend', _class='btn', _onclick='removeFriend(' + str(relationId) +');')}}
            {{else:}}
                {{=A('Add Friend', _class='btn btn-primary', _onclick='addFriend(' + str(user.id) +',"friend");')}}
            {{pass}}
        </div>
        {{pass}}
    </div>
</div>

<!-- User content area -->
<div class="row">
    <div class="span4">
        <div class="friend-container">
            {{=personItemList(friendRelations, userId)}}
        </div>
    </div>
    <div class="span8 post-container">
        {{=musicItemList(uploads)}}
    </div>
</div>

<!-- Edit profile modal -->
<!-- Modals -->
{{if auth.user and auth.user.id == userId :}}
    <div id="editModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        {{=editForm.custom.begin}}
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="myModalLabel">Edit your profile</h3>
        </div>
        <div class="modal-body">
            <!--First Name: <div>{{=editForm.custom.widget.first_name}}</div>-->
            <!--Last Name: <div>{{=editForm.custom.widget.last_name}}</div>-->
            Birthdate: <div>{{=editForm.custom.widget.birthdate}}</div>
            Gender: <div>{{=editForm.custom.widget.gender}}</div>
            Location: <div>{{=editForm.custom.widget.user_location}}</div>
            Genres: <div>{{=editForm.custom.widget.genres}}</div>
            Picture: <div>{{=editForm.custom.widget.picture}}</div>
        </div>
        <div class="modal-footer">
            {{=editForm.custom.submit}}
        </div>
        {{=editForm.custom.end}}
    </div>
    <!--=============================Status Modal -->
    <div id="statusModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        {{=statusForm.custom.begin}}
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="myModalLabel">Edit your status</h3>
        </div>
        <div class="modal-body">
            Status: <div>{{=statusForm.custom.widget.body}}</div>
        </div>
        <div class="modal-footer">
            {{=statusForm.custom.submit}}
        </div>
        {{=statusForm.custom.end}}
    </div>
{{pass}}

{{if auth.user:}}
<script>
    var addFriend = function(person, status) {
        $.ajax({
              type: "POST",
              url: "{{=URL('addFriend')}}",
              data: { person: person, status: status }
            })
        .done(function( msg ) {
            location.reload();
        });
    }
    var removeFriend = function(rid) {
        $.ajax({
              type: "POST",
              url: "{{=URL('removeFriend')}}",
              data: { rid: rid }
            })
        .done(function( msg ) {
            location.reload();
        });
    }
    var editStatus = function(status) {
        $.ajax({
              type: "POST",
              url: "{{=URL('editStatus')}}",
            data: { user: {{=str(auth.user.id)}}, status: status }
            })
        .done(function( msg ) {
            location.reload();
        });
    }
</script>
{{pass}}
